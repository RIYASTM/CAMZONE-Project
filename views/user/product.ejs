<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Detail</title>
    <link rel="stylesheet" href="/stylesheet/user/product.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        .stock.active {
            color: red;
        }
    </style>
</head>

<body>
    <header>
        <%- include('../partials/users/header', {search , cart }) %>
    </header>
    <nav class="breadcrumb">
        <a href="/">Home</a> > <a href="/shop">All Products</a> > <a href="#">
            <%= product.productName %>
        </a>
    </nav>
    <div class="container">
        <div class="product-detail">
            <div class="product-images">
                <!-- Main Image with Zoom Container -->
                <div class="main-image-container">
                    <% if (product.productImage && Array.isArray(product.productImage) && product.productImage.length > 0) { %>
                        <img src="<%= product.productImage[0] %>" alt="<%= product.productName %>"
                            class="main-image" id="mainImage">
                    <% } else { %>
                        <span>No Main Image</span>
                    <% } %>
                    <!-- Zoom Lens and Result -->
                    <div class="zoom-lens" id="zoomLens"></div>
                </div>

                <!-- Thumbnail Images with Carousel -->
                <div class="thumbnail-container">
                    <% if (product.productImage && Array.isArray(product.productImage) && product.productImage.length > 1) { %>
                        <div class="thumbnail-wrapper" id="thumbnailWrapper">
                            <% product.productImage.forEach((image, index)=> { %>
                                <img src="<%= image %>"
                                    alt="<%= product.productName %> Thumbnail <%= index %>"
                                    class="thumbnail <%= index === 0 ? 'active' : '' %>"
                                    data-src="<%= image %>"
                                    data-index="<%= index %>">
                            <% }) %>
                        </div>
                        <!-- Navigation arrows (only show if more than 3 images) -->
                        <% if (product.productImage.length > 4) { %>
                            <button class="thumbnail-nav prev" id="prevBtn">
                                <i class="fa fa-chevron-left"></i>
                            </button>
                            <button class="thumbnail-nav next" id="nextBtn">
                                <i class="fa fa-chevron-right"></i>
                            </button>
                        <% } %>
                    <% } else { %>
                        <span>No Thumbnails Available</span>
                    <% } %>
                </div>
            </div>
            <div class="product-info">
                <h1>
                    <%= product.productName %>
                </h1>
                <div class="price">
                    <% if ( product.salePrice < product.regularPrice || product.totalOffer) { %>
                        <span class="current">₹ <%= product.salePrice %></span>
                        <span class="original">₹ <%= product.regularPrice %></span>
                    <% } else { %>
                        <span class="current">₹ <%= product.regularPrice %></span>
                    <% } %>
                    <span class="current offer">
                        <%= totalOffer ? totalOffer + ' %' : '' %>
                    </span>
                </div>
                <p class="rating">★★★★★
                    <% if(product.status !=='Available' ){%>
                        <span class="stock active">
                            <%= product.status %>
                        </span>
                    <%}else{%>
                        <span class="stock">
                            <%= product.status %>
                        </span>
                        <% if (product.quantity <=5) { %>
                            <span class="stock active">Only <%= product.quantity %> left!!</span>
                        <% }else if(product.quantity < 10) { %>
                            <span class="stock active">Only few items left!!</span>
                        <% } %>
                    <%}%>
                </p>

                <p class="description">
                    <%= product.description %>
                </p>
                <div class="quantity">
                    <label for="quantity-input">Quantity :</label>
                    <div class="quantity-selector">
                        <button type="button" class="quantity-btn minus">-</button>
                        <input type="text" id="quantity-input" value="1" readonly>
                        <button type="button" class="quantity-btn plus">+</button>
                    </div>
                </div>
                <div class="buttons">
                    <% if(product.status !=='Available' ){%>
                        <span class="stock active">Available Soon</span>
                    <%}else{%>
                        <button class="add-to-cart" id="addtoCart" data-id="<%=product._id%>">Add to Cart</button>
                        <button class="buy-now">Buy Now</button>
                    <%}%>
                    <div class="wishlist-btn <%= wishlistItems.includes(product._id.toString()) ? 'active' : '' %>"
                        onclick="addtoWishlist('<%= product._id %>')">
                        <i class="fa fa-heart"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="tabs">
            <button class="tab active" data-tab="specifications">Specifications</button>
            <button class="tab" data-tab="reviews">Reviews</button>
            <div class="sku">Brand: <%= product.brand.brandName %></div>
            <div class="category">Category: <%= product.category.name %> 
                <span class="offer">
                    <%= product.category.categoryOffer ? product.category.categoryOffer + '%' : '' %>
                </span>
            </div>
        </div>
        <div class="tab-content" id="reviews">
            <p>No customer reviews yet</p>
        </div>
        <div class="related-products">
            <h2>Related Products</h2>
            <div class="product-grid">
                <% relatedProducts.forEach(product => { %>
                <div class="product-card" data-id="<%=product._id%>">
                    <% if (product.productImage && product.productImage.length> 0) { %>
                        <img src="<%= product.productImage[0] %>"
                            alt="<%= product.productName %>">
                    <% } else { %>
                        <span>No Image</span>
                    <% } %>
                    <div class="product-name <%= product.productName.length > 18 ? 'scrollable' : '' %>">
                        <span><%= product.productName %></span>
                    </div>


                    <div class="relatedprice">
                        <% if ( product.salePrice < product.regularPrice || totalOffer > 0) { %>
                            <span class="current">₹ <%= product.salePrice %></span>
                            <span class="original">₹ <%= product.regularPrice %></span>
                        <% } else { %>
                            <span class="current">₹ <%= product.regularPrice %></span>
                        <% } %>
                        <p class="current offer">
                            <%= totalOffer ? totalOffer + ' %' : '' %>
                        </p>
                    </div>
                    <span class="rating">
                        <%= '★' .repeat(product.rating ? product.rating : 1) %>
                    </span>
                </div>
                <% }) %>
            </div>
        </div>
    </div>
    <footer>
        <%- include('../partials/users/footer') %>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/javascript/users/product.js"></script>
</body>

</html>